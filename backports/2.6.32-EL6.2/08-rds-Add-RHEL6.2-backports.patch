From 7fcb2f5260095d495a96f53642e593e023a9a9b6 Mon Sep 17 00:00:00 2001
From: Vladimir Sokolovsky <vlad@mellanox.com>
Date: Fri, 23 Mar 2012 21:36:27 +0200
Subject: [PATCH] rds: Add RHEL6.2 backports

Signed-off-by: Vladimir Sokolovsky <vlad@mellanox.com>
---
 net/rds/tcp_listen.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/net/rds/tcp_listen.c b/net/rds/tcp_listen.c
index 8b5cc4a..4c5ab88 100644
--- a/net/rds/tcp_listen.c
+++ b/net/rds/tcp_listen.c
@@ -67,12 +67,21 @@ static int rds_tcp_accept_one(struct socket *sock)
 
 	inet = inet_sk(new_sock->sk);
 
+#if (LINUX_VERSION_CODE > KERNEL_VERSION(2,6,32))
 	rdsdebug("accepted tcp %pI4:%u -> %pI4:%u\n",
 		 &inet->inet_saddr, ntohs(inet->inet_sport),
 		 &inet->inet_daddr, ntohs(inet->inet_dport));
 
 	conn = rds_conn_create(inet->inet_saddr, inet->inet_daddr,
 			       &rds_tcp_transport, GFP_KERNEL);
+#else
+	rdsdebug("accepted tcp %pI4:%u -> %pI4:%u\n",
+		 &inet->saddr, ntohs(inet->sport),
+		 &inet->daddr, ntohs(inet->dport));
+
+	conn = rds_conn_create(inet->saddr, inet->daddr,
+			       &rds_tcp_transport, GFP_KERNEL);
+#endif
 	if (IS_ERR(conn)) {
 		ret = PTR_ERR(conn);
 		goto out;
-- 
1.5.4.3

