From: Tatyana Nikolova <Tatyana.E.Nikolova@intel.com>
Subject: [PATCH] RDMA/nes: Fix for loopback MAC address - Backport change

RDMA/nes: Fix for resolving correctly the MAC address for loopback connection
(the patch should be applied on top of previous backports)

Signed-off-by: Tatyana Nikolova <Tatyana.E.Nikolova@intel.com>
---
 drivers/infiniband/hw/nes/nes_cm.c |    5 +----
 1 files changed, 1 insertions(+), 4 deletions(-)

diff --git a/drivers/infiniband/hw/nes/nes_cm.c b/drivers/infiniband/hw/nes/nes_cm.c
index xxxxxxx..xxxxxxx xxxxxx
--- a/drivers/infiniband/hw/nes/nes_cm.c
+++ b/drivers/infiniband/hw/nes/nes_cm.c
@@ -1363,11 +1363,8 @@ static int nes_addr_resolve_neigh(struct nes_vnic *nesvnic, u32 dst_ip, int arpi
 	else
 		netdev = nesvnic->netdev;
 
-#if (LINUX_VERSION_CODE < KERNEL_VERSION(3,1,0))
 	neigh = neigh_lookup(&arp_tbl, &rt->rt_gateway, netdev);
-#else
-	neigh = dst_neigh_lookup(&rt->dst, &dst_ip);
-#endif
+
 	rcu_read_lock();
 	if (neigh) {
 		if (neigh->nud_state & NUD_VALID) {
