From: Vladimir Sokolovsky <vlad@mellanox.com>
Subject: [PATCH] mlx4_en: Backport for RHEL6.6

Signed-off-by: Vladimir Sokolovsky <vlad@mellanox.com>
---
 drivers/net/ethernet/mellanox/mlx4/en_netdev.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/net/ethernet/mellanox/mlx4/en_netdev.c b/drivers/net/ethernet/mellanox/mlx4/en_netdev.c
index xxxxxxx..xxxxxxx xxxxxx
--- a/drivers/net/ethernet/mellanox/mlx4/en_netdev.c
+++ b/drivers/net/ethernet/mellanox/mlx4/en_netdev.c
@@ -73,6 +73,7 @@ int mlx4_en_setup_tc(struct net_device *dev, u8 up)
 #endif
 
 #ifdef CONFIG_NET_RX_BUSY_POLL
+#ifndef CONFIG_COMPAT_IS_NETDEV_EXTENDED
 /* must be called with local_bh_disable()d */
 static int mlx4_en_low_latency_recv(struct napi_struct *napi)
 {
@@ -98,6 +99,7 @@ static int mlx4_en_low_latency_recv(struct napi_struct *napi)
 
 	return done;
 }
+#endif
 #endif	/* CONFIG_NET_RX_BUSY_POLL */
 
 #ifdef CONFIG_RFS_ACCEL
@@ -2248,8 +2250,10 @@ static const struct net_device_ops mlx4_netdev_ops = {
 #endif
 #endif
 #ifdef CONFIG_NET_RX_BUSY_POLL
+#ifndef CONFIG_COMPAT_IS_NETDEV_EXTENDED
 	.ndo_busy_poll		= mlx4_en_low_latency_recv,
 #endif
+#endif
 };
 
 static const struct net_device_ops mlx4_netdev_ops_master = {
