From: Vladimir Sokolovsky <vlad@mellanox.com>
Subject: [PATCH] BACKPORT: core/netlink for kernels <= 3.4

Signed-off-by: Vladimir Sokolovsky <vlad@mellanox.com>
---
 drivers/infiniband/core/netlink.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/infiniband/core/netlink.c b/drivers/infiniband/core/netlink.c
index xxxxxxx..xxxxxxx xxxxxx
--- a/drivers/infiniband/core/netlink.c
+++ b/drivers/infiniband/core/netlink.c
@@ -149,12 +149,18 @@ static int ibnl_rcv_msg(struct sk_buff *skb, struct nlmsghdr *nlh)
 			    !client->cb_table[RDMA_NL_GET_OP(op)].dump)
 				return -EINVAL;
 
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(3,4,0))
 			{
 				struct netlink_dump_control c = {
 					.dump = client->cb_table[op].dump,
 				};
 				return netlink_dump_start(nls, skb, nlh, &c);
 			}
+#else
+			return netlink_dump_start(nls, skb, nlh,
+						  client->cb_table[op].dump,
+						  NULL, 0);
+#endif /* (LINUX_VERSION_CODE < KERNEL_VERSION(3,4,0)) */
 		}
 	}
 
