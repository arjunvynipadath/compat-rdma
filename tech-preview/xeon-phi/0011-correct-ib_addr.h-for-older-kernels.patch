xeon-phi: correct ib_addr.h for older kernels
---
diff -ruN a10/include/rdma/ib_addr.h a11/include/rdma/ib_addr.h
--- a10/include/rdma/ib_addr.h	2015-09-10 09:35:55.061958421 -0700
+++ a11/include/rdma/ib_addr.h	2015-09-10 09:36:18.093901591 -0700
@@ -239,6 +239,27 @@
 		return 0;
 }
 
+#if LINUX_VERSION_CODE < KERNEL_VERSION(3,2,0)
+static inline int iboe_get_rate(struct net_device *dev)
+{
+	struct ethtool_cmd cmd;
+
+	if (!dev->ethtool_ops || !dev->ethtool_ops->get_settings ||
+	    dev->ethtool_ops->get_settings(dev, &cmd))
+		return IB_RATE_PORT_CURRENT;
+
+	if (cmd.speed >= 40000)
+		return IB_RATE_40_GBPS;
+	else if (cmd.speed >= 30000)
+		return IB_RATE_30_GBPS;
+	else if (cmd.speed >= 20000)
+		return IB_RATE_20_GBPS;
+	else if (cmd.speed >= 10000)
+		return IB_RATE_10_GBPS;
+	else
+		return IB_RATE_PORT_CURRENT;
+}
+#else
 static inline int iboe_get_rate(struct net_device *dev)
 {
 	struct ethtool_cmd cmd;
@@ -263,6 +284,7 @@
 	else
 		return IB_RATE_PORT_CURRENT;
 }
+#endif
 
 static inline int rdma_link_local_addr(struct in6_addr *addr)
 {
